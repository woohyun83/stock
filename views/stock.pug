extends layout

block css
  link(rel="stylesheet", href="/static/css/stock.css")

block content
  div(class="alert alert-danger alert-dismissible d-none", role="alert", id="danger")
    i(class="fa fa-fw fa-exclamation-triangle", aria-hidden="true")
    span(id="message")
  div(class="py-3 container-fluid")
    div(style="display: none", id="dropzone-preview-template")
      div(class="dz-preview dz-file-preview", id="dz-preview-template", style="border: none; padding: 6px 0px 0px 5px")
        div(class="dz-details row")
          div(class="dz-filename col-7")
            span(data-dz-name)
          div(class="dz-size", data-dz-size style="flex: 0 0 23.33333%;max-width: 23.33333%;")
          div(class="col-1", style="text-align:center;")
            a(class="dz-remove", style="cursor:pointer;color:red", data-dz-remove) clear
  // container for chart and table
  div.container
    // header controls: collapse/expand
    .d-flex.justify-content-end.mb-1
        .d-flex.justify-content-between.mb-1.align-items-center
          // tabs
          .btn-group(role='tablist')
            button.btn.btn-sm.btn-outline-secondary#tabIndustry(data-mode='industry') Industry
            button.btn.btn-sm.btn-outline-secondary#tabTheme(data-mode='theme') Theme
          // toggle
          button.btn.btn-sm.btn-outline-secondary#toggleIndustryBtn(type='button') Toggle
    // industry summary table (top industries)
    .table-responsive.mt-2#indutryWrapper
      // use the same table classes as the main stock table so styles match
      table.table.table-striped#indutryTable
        thead
          tr
            th(data-key='induty_name') Name
            th(data-key='prevTradeVolume') PrevTradeVolume
            th(data-key='tradeVolume') TradeVolume
            th(data-key='pctChange') Change%
        tbody
          // filled by client JS
    // responsive chart container
    .chart-container
      .chart-title-bar.d-flex.justify-content-between.align-items-center.mb-2
        // left: watch toggle
        .d-flex.align-items-center
          select.form-control#watchlistSelect(style='margin-right:10px;height:31px;padding:0 10px;')
          button.btn.btn-sm.btn-outline-secondary#watchToggleBtn(type='button', title='Add/remove watchlist', style='display:none;') +
        // center: title
        .d-flex.text-center.flex-grow-1.align-items-center.justify-content-center
          h5.mb-0.mx-2.d-inline-block#chartTitle
        // right: prev and next
        .d-flex.align-items-center
          button.btn.btn-sm.btn-outline-secondary#chartPrevBtn(type='button') ◀
          button.btn.btn-sm.btn-outline-secondary#chartNextBtn(type='button') ▶
      canvas#stockChart
    // responsive table wrapper
    .table-responsive
      table.table.table-striped#stockTable
        thead
          tr
            th(data-key='code') Code
            th(data-key='name') Name
            th(data-key='market') Market
            th(data-key='closePrice') ClosePrice
            th(data-key='prevTradeVolume') PrevTradeVolume
            th(data-key='tradeVolume') TradeVolume
            th(data-key='pctChange') Change%
            th#hdr-5dchange(data-key='avg5d') 5dChange
        tbody
          // initial rows will be filled by client JS
        tfoot
          tr
            td(colspan='8')
              // pagination controls (filled by JS)
              nav(aria-label='Stock table pagination')
                ul.pagination#stockPagination
    // date selector styles moved to /static/css/stock.css
    // date controls: moved below the table. Latest dates shown first. Collapsible with toggle.
    .row.mt-3
      .col-md-2
        // market filter
        select.form-control#marketFilter
          option(value='all') All Markets
          option(value='KOSPI') KOSPI
          option(value='KOSDAQ') KOSDAQ
      .col-md-4
        // name search
        input.form-control#nameFilter(type='text', placeholder='Search by name')
      .col-md-2
        select.form-control#topN
          option(value='10') 10
          option(value='20') 20
          option(value='50' selected) 50
          option(value='100') 100
          option(value='200') 200
      .col-md-2
        div(class='d-flex align-items-center mb-2')
          button.btn.btn-secondary#toggleDatesBtn(type='button') Show dates
      .col-md-2
        div(class='d-flex align-items-center mb-2')
          button.btn.btn-secondary#delDateBtn(type='button') Delete date
    .row.mt-3
      .col-md-12
        // date list container
        - var revDates = (dates || []).slice().reverse();
        div(class='py-2' id='stock_date')
          each date in revDates
            div(class='date' id=date) #{date}

block js
  script.
    var websocket_host = "#{websocket_host}";
    var currentUserId = "#{(user && user.id) ? user.id : ''}";
  script(src='/socket.io/socket.io.js')
  script(src='/static/js/connect.js')
  script(src='/static/js/browser_check.js')
  script(src='/static/js/dropzone.js')
  // Chart.js CDN
  script(src='https://cdn.jsdelivr.net/npm/chart.js')
  script(src='/static/js/stock.js')

block footer
  footer(class="mt-3 py-3")
    div(class="container-fluid")
      p(class="mb-0") Copyright © 2023 Hyunmnb. Seoul, Korea.
